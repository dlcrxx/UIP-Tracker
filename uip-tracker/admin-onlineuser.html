<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Online Users Tracker</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css">
  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="admin-onlineuser.css" />
</head>
<body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="logo.png" alt="logo" />
        <span class="logo-text">UIP<br>Admin Panel</span>
      </div>
      <ul class="sidebar-links">
        <li><a href="admin-dashboard.html"><span class="material-symbols-outlined">dashboard</span>Dashboard</a></li>
        <li><a href="admin-attendance.html" class="active"><span class="material-symbols-outlined">calendar_month</span>Attendance<span class="chevron">&gt;</span></a></li>
        <li><a href="admin-onlineuser.html"><span class="material-symbols-outlined">account_circle</span>Online Users<span class="chevron">&gt;</span></a></li>
        <li><a href="admin-event.html"><span class="material-symbols-outlined">notifications_active</span>Event<span class="chevron">&gt;</span></a></li>
        <li><a href="admin-help.html"><span class="material-symbols-outlined">help</span>Help<span class="chevron">&gt;</span></a></li>
        <li><a href="admin-developers.html"><span class="material-symbols-outlined">deployed_code</span>Developers<span class="chevron">&gt;</span></a></li>
      </ul>
    </aside>

    <main class="main-content">
      <!-- Header -->
      <div class="header">
        <h2 id="currentDateTime"></h2>
        <button class="user-profile" onclick="toggleDropdown()">
          <div class="user-avatar">AD</div>
          <div class="user-details">
            <h3>Admin User</h3>
            <p>System Administrator</p>
          </div>
          <span class="material-symbols-outlined" style="color: #9197B3;">expand_more</span>
          <div class="dropdown-menu" id="userDropdown">
            <a href="#" class="dropdown-item"><span class="material-symbols-outlined">person</span>Profile</a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item"><span class="material-symbols-outlined">logout</span>Sign out</a>
          </div>
        </button>
      </div>

      <!-- All Users Table -->
      <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Active Users</h3>
            <div class="table-controls">
                <!-- Advanced Filters -->
                <select id="statusFilter" class="form-select form-select-sm">
                    <option value="">All Statuses</option>
                    <option value="ONLINE">Online</option>
                    <option value="OFFLINE">Offline</option>
                </select>
                <select id="roleFilter" class="form-select form-select-sm">
                    <option value="">All Roles</option>
                    <option value="Admin">Admin</option>
                    <option value="Staff">Staff</option>
                    <option value="Intern">Intern</option>
                </select>

                <!-- Search Bar -->
                <input type="text" id="userSearch" class="form-control form-control-sm" placeholder="Search users...">
                
                <!-- Export Buttons -->
                <button id="copyBtn" class="btn btn-sm btn-secondary"><span class="material-symbols-outlined">content_copy</span></button>
                <button id="excelBtn" class="btn btn-sm btn-secondary"><span class="material-symbols-outlined">download_for_offline</span></button>
                <button id="pdfBtn" class="btn btn-sm btn-secondary"><span class="material-symbols-outlined">picture_as_pdf</span></button>
            </div>
        </div>
        <div class="card-body">
          <table id="usersTable" class="table table-striped table-bordered" style="width:100%">
            <thead>
              <tr>
                <th>User</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Activity</th>
                <th>IP Address</th>
                <th class="no-sort">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- User data will be inserted here dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <!-- DataTables Buttons extension -->
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>

    <script>
    $(document).ready(function () {
      // Combined sample data for all users
      const allUsersData = [
        { profile: "profile3.png", name: "Admin User", role: "Admin", status: "ONLINE", lastActivity: "2024-08-14 17:40:05", ip: "192.168.1.1" },
        { profile: "profile6.png", name: "Johnson, Robert", role: "Staff", status: "ONLINE", lastActivity: "2024-08-14 17:35:12", ip: "203.177.15.21" },
        { profile: "profile1.png", name: "Smith, John D.", role: "Intern", status: "ONLINE", lastActivity: "2024-08-14 16:55:41", ip: "103.22.45.110" },
        { profile: "profile2.png", name: "Doe, Jane M.", role: "Intern", status: "OFFLINE", lastActivity: "2024-08-14 12:30:10", ip: "103.22.45.112" },
        { profile: "profile5.png", name: "Garcia, Maria C.", role: "Intern", status: "OFFLINE", lastActivity: "2024-08-13 17:01:00", ip: "180.191.12.34" },
        { profile: "profile4.png", name: "Lee, Bruce W.", role: "Intern", status: "ONLINE", lastActivity: "2024-08-14 15:10:22", ip: "103.22.45.111" },
      ];

      // Populate user table
      const userTableBody = $("#usersTable tbody");
      allUsersData.forEach(user => {
        const statusClass = user.status === "ONLINE" ? "online" : "offline";
        let roleClass = '';
        if (user.role === 'Admin') roleClass = 'bg-danger';
        else if (user.role === 'Staff') roleClass = 'bg-info';
        else roleClass = 'bg-secondary';
        
        const row = `
          <tr>
            <td>
                <div class="d-flex align-items-center">
                    <img src="${user.profile}" alt="profile" class="profile-pic">
                    <span class="user-name">${user.name}</span>
                </div>
            </td>
            <td><span class="badge ${roleClass}">${user.role}</span></td>
            <td><span class="status-dot ${statusClass}"></span> ${user.status}</td>
            <td>${user.lastActivity}</td>
            <td>${user.ip}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary action-btn" title="View Details"><span class="material-symbols-outlined">visibility</span></button>
                <button class="btn btn-sm btn-outline-secondary action-btn" title="Message User"><span class="material-symbols-outlined">mail</span></button>
                <button class="btn btn-sm btn-outline-danger action-btn" title="Force Logout"><span class="material-symbols-outlined">logout</span></button>
            </td>
          </tr>`;
        userTableBody.append(row);
      });

      // Initialize DataTable
      const usersTable = $("#usersTable").DataTable({
        pageLength: 10,
        dom: 't<"row pt-3"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
        buttons: [
          { extend: 'copyHtml5', className: 'd-none', exportOptions: { columns: ':not(.no-sort)' } },
          { extend: 'excelHtml5', className: 'd-none', exportOptions: { columns: ':not(.no-sort)' } },
          { extend: 'pdfHtml5', className: 'd-none', exportOptions: { columns: ':not(.no-sort)' } }
        ],
        columnDefs: [
            { "orderable": false, "targets": 'no-sort' } // Disable sorting on the 'Actions' column
        ]
      });
      
      // Link custom search bar
      $('#userSearch').on('keyup', function(){
          usersTable.search(this.value).draw();
      });

      // Link custom filters
      $('#statusFilter').on('change', function(){
          let status = $(this).val();
          usersTable.column(2).search(status).draw();
      });

      $('#roleFilter').on('change', function(){
          let role = $(this).val();
          usersTable.column(1).search(role).draw();
      });

      // Export buttons triggers
      $('#copyBtn').on('click', function() { usersTable.button('.buttons-copy').trigger(); });
      $('#excelBtn').on('click', function() { usersTable.button('.buttons-excel').trigger(); });
      $('#pdfBtn').on('click', function() { usersTable.button('.buttons-pdf').trigger(); });
    });

    // Time updater
    function updateTime() {
      const now = new Date();
      document.getElementById('currentDateTime').textContent = now.toLocaleString('en-US', {
          dateStyle: 'full',
          timeStyle: 'medium'
      });
    }
    updateTime();
    setInterval(updateTime, 1000);

    // Dropdown functionality
    function toggleDropdown() {
      document.getElementById('userDropdown').classList.toggle('show');
    }
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.user-profile')) {
        document.getElementById('userDropdown').classList.remove('show');
      }
    });
    </script>
</body>
</html>