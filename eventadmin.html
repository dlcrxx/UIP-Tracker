<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin - Event Manager</title>
  <link rel="stylesheet" href="eventadmin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
</head>
<body>
    <!-- Mobile menu toggle button (matches intern side design) -->
    <button class="mobile-menu-toggle" onclick="toggleMobileSidebar()">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Admin sidebar navigation (matches intern side structure) -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="tracker logo.png" alt="logo" />
        <span class="logo-text">UIP <br>Tracker</span>
      </div>

      <ul class="sidebar-links">
        <li><a href="#"><span class="material-symbols-outlined">dashboard</span>Dashboard<span class="chevron">&gt;</span></a></li>
        <li><a href="#"><span class="material-symbols-outlined">groups</span>Attendance<span class="chevron">&gt;</span></a></li>
        <li><a href="#"><span class="material-symbols-outlined">account_circle</span>Online Users<span class="chevron">&gt;</span></a></li>
        <li><a href="event.html" class="active"><span class="material-symbols-outlined">notifications_active</span>Event Manager<span class="chevron">&gt;</span></a></li>
        <li><a href="#"><span class="material-symbols-outlined">flag</span>Help<span class="chevron">&gt;</span></a></li>
        <li><a href="#"><span class="material-symbols-outlined">groups</span>Developers<span class="chevron">&gt;</span></a></li>
      </ul>
    </aside>

    <main class="main-content">
        <!-- Admin header with title and user profile (matches intern side) -->
        <div class="header">
          <h1><i class="fas fa-cog"></i> Event Manager - Admin Panel</h1>
          <button class="user-profile" onclick="toggleDropdown()">
            <div class="user-avatar">AD</div>
            <div class="user-details">
              <h3>Admin User</h3>
              <p>Administrator</p>
            </div>
            <span class="material-symbols-outlined" style="color: #9197B3;">expand_more</span>
          </button>
        </div>

        <!-- Success/Error message display area -->
        <div id="messageArea"></div>

        <!-- Main admin panel layout with form and events list -->
        <div class="admin-panel">
            <!-- Event creation/editing form -->
            <div class="event-form-card">
                <h2 id="formTitle"><i class="fas fa-plus-circle"></i> Add New Event</h2>
                <form id="eventForm">
                    <!-- Hidden field for event ID when editing -->
                    <input type="hidden" id="eventId" value="">
                    
                    <!-- Event title input -->
                    <div class="form-group">
                        <label for="eventTitle">Event Title *</label>
                        <input type="text" id="eventTitle" required placeholder="Enter event title">
                    </div>
                    
                    <!-- Event date input -->
                    <div class="form-group">
                        <label for="eventDate">Event Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    
                    <!-- Event description textarea -->
                    <div class="form-group">
                        <label for="eventDescription">Description *</label>
                        <textarea id="eventDescription" required placeholder="Enter event description"></textarea>
                    </div>
                    
                    <!-- Event image file input -->
                    <div class="form-group">
                        <label for="eventImage">Event Image</label>
                        <input type="file" id="eventImage" accept="image/*">
                        <div id="currentImage" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Form action buttons -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Event
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </form>
            </div>

            <!-- Events list display -->
            <div class="events-list-card">
                <h2><i class="fas fa-list"></i> Existing Events</h2>
                <div id="eventsList"></div>
            </div>
        </div>
    </main>

    <!-- Confirmation modal for delete operations -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete this event? This action cannot be undone.</p>
            <div style="margin-top: 20px;">
                <button class="btn btn-danger" id="confirmDelete">Delete</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

<script>
    /**
     * Event Management System for Admin Panel
     * Handles CRUD operations for calendar events with localStorage persistence
     * Modified from intern-side static events to dynamic admin-managed events
     */

    // Global events storage - Modified: Changed from static array to dynamic localStorage-based system
    let events = [];
    let editingEventId = null;

    /**
     * Initialize the admin panel on page load
     * Loads existing events and sets up the interface
     */
    document.addEventListener('DOMContentLoaded', function() {
        loadEvents();
        displayEvents();
        setupEventHandlers();
    });

    /**
     * Load events from localStorage
     * Modified: Added persistence layer that wasn't in original intern-side code
     */
    function loadEvents() {
        const savedEvents = localStorage.getItem('calendarEvents');
        if (savedEvents) {
            events = JSON.parse(savedEvents);
        } else {
            // Initialize with sample data if no events exist
            events = [
                { 
                    id: generateId(), 
                    date: "2025-08-08", 
                    title: "Barangay Cleanup", 
                    description: "A community cleanup.", 
                    image: "SUBO.jpg" 
                },
                { 
                    id: generateId(), 
                    date: "2025-08-10", 
                    title: "Barangay Cleanup", 
                    description: "A community cleanup.", 
                    image: "SUBO.jpg" 
                },
                { 
                    id: generateId(), 
                    date: "2025-08-15", 
                    title: "Medical Mission", 
                    description: "Free checkups for residents.", 
                    image: "medical.jpg" 
                }
            ];
            saveEvents();
        }
    }

    /**
     * Save events to localStorage
     * Modified: Added persistence functionality for admin changes
     */
    function saveEvents() {
        localStorage.setItem('calendarEvents', JSON.stringify(events));
        
        // Trigger a custom event to notify the intern-side calendar of changes
        window.dispatchEvent(new CustomEvent('eventsUpdated', { detail: events }));
    }

    /**
     * Generate unique ID for new events
     * Added: New function for managing event IDs in admin system
     */
    function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    /**
     * Display all events in the admin list
     * Added: Admin-specific event display functionality
     */
    function displayEvents() {
        const eventsList = document.getElementById('eventsList');
        
        if (events.length === 0) {
            eventsList.innerHTML = '<p style="text-align: center; color: #6c757d; font-style: italic;">No events found. Add your first event!</p>';
            return;
        }

        // Sort events by date for better organization
        const sortedEvents = events.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        eventsList.innerHTML = sortedEvents.map(event => `
            <div class="event-item" data-event-id="${event.id}">
                <h3>${event.title}</h3>
                <div class="event-date">
                    <i class="fas fa-calendar-alt"></i> ${formatDate(event.date)}
                </div>
                <div class="event-description">${event.description}</div>
                <div class="event-actions">
                    <button class="btn btn-edit" onclick="editEvent('${event.id}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger" onclick="deleteEvent('${event.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        `).join('');
    }

    /**
     * Format date for better display
     * Added: Helper function for consistent date formatting
     */
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }

    /**
     * Set up event handlers for form submission
     * Added: Admin form handling functionality
     */
    function setupEventHandlers() {
        const form = document.getElementById('eventForm');
        form.addEventListener('submit', handleFormSubmit);

        // Handle image file selection
        const imageInput = document.getElementById('eventImage');
        imageInput.addEventListener('change', handleImageSelect);
    }

    /**
     * Handle form submission for adding/editing events
     * Added: Complete form processing for admin operations
     */
    function handleFormSubmit(e) {
        e.preventDefault();
        
        const title = document.getElementById('eventTitle').value.trim();
        const date = document.getElementById('eventDate').value;
        const description = document.getElementById('eventDescription').value.trim();
        const imageFile = document.getElementById('eventImage').files[0];
        
        // Validate required fields
        if (!title || !date || !description) {
            showMessage('Please fill in all required fields.', 'error');
            return;
        }
        
        // Create or update event object
        const eventData = {
            title: title,
            date: date,
            description: description
        };
        
        // Handle image - in a real application, you'd upload to a server
        if (imageFile) {
            // For demo purposes, we'll use a placeholder or the filename
            eventData.image = imageFile.name;
        } else if (editingEventId) {
            // Keep existing image if no new image selected during edit
            const existingEvent = events.find(e => e.id === editingEventId);
            eventData.image = existingEvent ? existingEvent.image : 'default.jpg';
        } else {
            eventData.image = 'default.jpg';
        }
        
        if (editingEventId) {
            updateEvent(editingEventId, eventData);
        } else {
            addEvent(eventData);
        }
    }

    /**
     * Handle image file selection and preview
     * Added: Image handling for event creation
     */
    function handleImageSelect(e) {
        const file = e.target.files[0];
        const currentImageDiv = document.getElementById('currentImage');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageDiv.innerHTML = `
                    <p style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Selected image:</p>
                    <img src="${e.target.result}" alt="Preview" style="max-width: 100px; max-height: 100px; border-radius: 5px;">
                `;
            };
            reader.readAsDataURL(file);
        }
    }

    /**
     * Add new event to the system
     * Added: Event creation functionality for admin
     */
    function addEvent(eventData) {
        const newEvent = {
            ...eventData,
            id: generateId()
        };
        
        events.push(newEvent);
        saveEvents();
        displayEvents();
        resetForm();
        showMessage('Event added successfully!', 'success');
    }

    /**
     * Update existing event
     * Added: Event modification functionality for admin
     */
    function updateEvent(id, eventData) {
        const index = events.findIndex(e => e.id === id);
        if (index !== -1) {
            events[index] = { ...events[index], ...eventData };
            saveEvents();
            displayEvents();
            resetForm();
            showMessage('Event updated successfully!', 'success');
        }
    }

    /**
     * Edit an existing event (load into form)
     * Added: Event editing interface functionality
     */
    function editEvent(id) {
        const event = events.find(e => e.id === id);
        if (!event) return;
        
        editingEventId = id;
        
        // Populate form with event data
        document.getElementById('eventId').value = id;
        document.getElementById('eventTitle').value = event.title;
        document.getElementById('eventDate').value = event.date;
        document.getElementById('eventDescription').value = event.description;
        
        // Show current image if exists
        const currentImageDiv = document.getElementById('currentImage');
        if (event.image && event.image !== 'default.jpg') {
            currentImageDiv.innerHTML = `
                <p style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">Current image:</p>
                <p style="font-size: 12px; font-style: italic;">${event.image}</p>
            `;
        }
        
        // Update form title and button text
        document.getElementById('formTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Event';
        document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Event';
        
        // Scroll to form for better UX
        document.querySelector('.event-form-card').scrollIntoView({ behavior: 'smooth' });
    }

    /**
     * Delete an event with confirmation
     * Added: Event deletion functionality for admin
     */
    function deleteEvent(id) {
        const event = events.find(e => e.id === id);
        if (!event) return;
        
        // Show confirmation modal
        const modal = document.getElementById('confirmModal');
        modal.style.display = 'block';
        
        // Set up confirmation handler
        document.getElementById('confirmDelete').onclick = function() {
            const index = events.findIndex(e => e.id === id);
            if (index !== -1) {
                events.splice(index, 1);
                saveEvents();
                displayEvents();
                showMessage('Event deleted successfully!', 'success');
            }
            closeModal();
        };
    }

    /**
     * Reset the form to initial state
     * Added: Form reset functionality for admin interface
     */
    function resetForm() {
        editingEventId = null;
        document.getElementById('eventForm').reset();
        document.getElementById('eventId').value = '';
        document.getElementById('currentImage').innerHTML = '';
        
        // Reset form title and button text
        document.getElementById('formTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Add New Event';
        document.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Save Event';
    }

    /**
     * Show success/error messages to user
     * Added: User feedback system for admin operations
     */
    function showMessage(message, type) {
        const messageArea = document.getElementById('messageArea');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
            ${message}
        `;
        
        messageArea.innerHTML = '';
        messageArea.appendChild(messageDiv);
        
        // Auto-hide message after 5 seconds
        setTimeout(() => {
            messageDiv.style.opacity = '0';
            setTimeout(() => messageArea.removeChild(messageDiv), 300);
        }, 5000);
        
        // Scroll to top to show message
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /**
     * Close confirmation modal
     * Added: Modal management for delete confirmations
     */
    function closeModal() {
        document.getElementById('confirmModal').style.display = 'none';
    }

    /**
     * Toggle mobile sidebar - matches intern-side functionality
     * Modified: Copied from intern-side for consistency
     */
    function toggleMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('active');
    }

    /**
     * Toggle user dropdown - matches intern-side functionality
     * Modified: Copied from intern-side for consistency
     */
    function toggleDropdown() {
        // Placeholder for dropdown functionality
        console.log('Admin dropdown toggled');
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
        const modal = document.getElementById('confirmModal');
        if (event.target === modal) {
            closeModal();
        }
    }

    // Close mobile sidebar when clicking outside - matches intern-side functionality
    document.addEventListener('click', function(event) {
        const sidebar = document.getElementById('sidebar');
        const mobileToggle = document.querySelector('.mobile-menu-toggle');
        
        if (window.innerWidth <= 768 && 
            !sidebar.contains(event.target) && 
            !mobileToggle.contains(event.target)) {
            sidebar.classList.remove('active');
        }
    });

    /**
     * Export events data for backup purposes
     * Added: Additional admin utility function
     */
    function exportEvents() {
        const dataStr = JSON.stringify(events, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'calendar-events-backup.json';
        link.click();
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>